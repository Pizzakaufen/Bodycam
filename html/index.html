<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ryze Axon Body 4 / Axon Fleet 3</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body style="margin:0;padding:0;overflow:visible;">
    <!-- Original Bodycam HUD -->
    <div id="hud" class="hidden">
        <img src="textures/static.png" alt="static" id="static">
        <div class="overlay">
            <img src="textures/batt.png" alt="batt-symbol" id="batt-symbol" class="hidden" />
            <img src="textures/red.png" alt="red-light" id="red-light" class="hidden" />
            <img src="textures/green.png" alt="green-light" id="green-light" class="hidden" />
            <img src="textures/ready.png" alt="ready-symbol" id="ready-symbol" class="hidden" />
            <img src="textures/rec.png" alt="rec-symbol" id="rec-symbol" class="hidden" />
            <img src="textures/saving.png" alt="saving-symbol" id="saving-symbol" class="hidden" />
            <img src="textures/starting.png" alt="starting-symbol" id="starting-symbol" class="hidden" />
        </div>
    </div>

    <!-- Axon Bodycam UI (oben rechts) - Neue Vorlage -->
    <script src="nui://game/ui/jquery.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.1/howler.min.js" type="text/javascript"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
    
    <script>
        var audioPlayer = null;
        
        // Axon UI Funktionen
        function showAxonUI(data) {
            var div = document.getElementById("axonOverlay");
            if (!div) {
                setTimeout(function() {
                    div = document.getElementById("axonOverlay");
                    if (div && data.show === true) {
                        div.style.display = "block";
                    }
                }, 100);
                return;
            }
            
            if (data.show === true) {
                div.style.display = "block";
                div.style.visibility = "visible";
                div.style.opacity = "1";
                div.style.position = "fixed";
                div.style.top = "10px";
                div.style.right = "10px";
                div.style.zIndex = "999999";
                div.style.pointerEvents = "none";
                
                // Force reflow
                div.offsetHeight;

                // Format timestamp - use real time if placeholder
                var timestamp = data.timestamp || "REALTIME";
                if (timestamp === "REALTIME") {
                    var now = new Date();
                    var year = now.getFullYear();
                    var month = String(now.getMonth() + 1).padStart(2, '0');
                    var day = String(now.getDate()).padStart(2, '0');
                    var hours = String(now.getHours()).padStart(2, '0');
                    var minutes = String(now.getMinutes()).padStart(2, '0');
                    timestamp = year + "-" + month + "-" + day + " T" + hours + ":" + minutes;
                }
                
                var timestampEl = document.getElementById("timestamp");
                var serialEl = document.getElementById("serial");
                if (timestampEl) {
                    timestampEl.innerHTML = timestamp;
                }
                if (serialEl && data.serial) {
                    serialEl.innerHTML = data.serial;
                }
            } else {
                div.style.display = "none";
                div.style.visibility = "hidden";
            }
        }
        
        function updateAxonTime(timestamp) {
            if (timestamp === "REALTIME") {
                var now = new Date();
                var year = now.getFullYear();
                var month = String(now.getMonth() + 1).padStart(2, '0');
                var day = String(now.getDate()).padStart(2, '0');
                var hours = String(now.getHours()).padStart(2, '0');
                var minutes = String(now.getMinutes()).padStart(2, '0');
                timestamp = year + "-" + month + "-" + day + " T" + hours + ":" + minutes;
            }
            var timestampEl = document.getElementById("timestamp");
            if (timestampEl) {
                timestampEl.innerHTML = timestamp;
            }
            var timestamp2El = document.getElementById("timestamp2");
            if (timestamp2El) {
                timestamp2El.innerHTML = timestamp;
            }
            
            // Stelle sicher, dass die UI sichtbar ist, wenn updateTime kommt
            var div = document.getElementById("axonOverlay");
            if (div && div.style.display === "none") {
                div.style.display = "block";
                div.style.visibility = "visible";
            }
        }
        
        // Einheitlicher Event Listener f√ºr alle NUI Messages
        window.addEventListener('message', function(event) {
            var data = event.data;
            
            // Axon UI Events
            if (data.transactionType == "showAxon") {
                showAxonUI(data);
            } else if (data.transactionType == "updateTime") {
                updateAxonTime(data.timestamp || "REALTIME");
            } else if (data.transactionType == "playSound") {
                if (audioPlayer != null) {
                    audioPlayer.pause();
                }
                if (data.transactionFile) {
                    audioPlayer = new Howl({
                        src: ["./sounds/" + data.transactionFile + ".ogg"], 
                        autoplay: false, 
                        loop: true, 
                        volume: data.transactionVolume || 1.0
                    });
                    audioPlayer.play();
                }
            }
        });
    </script>

    <!-- Axon UI oben rechts -->
    <div id='axonOverlay' style='display:none;position:fixed;top:10px;right:10px;z-index:999999;pointer-events:none;width:auto;height:auto;background:transparent;'>
        <div style='color:#ffffff;font-weight:bold;font-size:1.6rem;height:auto;position:relative;text-align:right;'>
            <div style="font-family: 'Roboto Mono', monospace;padding-top:2.5px;padding-right:10px;text-shadow: 2px 2px 4px rgba(0,0,0,0.9);white-space:nowrap;">
                <div id='timestamp' style='display:block;line-height:1.2;color:#ffffff;'>2020-09-29 T18:29</div>
                <div id='serial' style='display:block;line-height:1.2;color:#ffffff;'>AXON BODY 2 X81020805</div>
            </div>
        </div>
    </div>

    <div id='revealOverlay' style='display:none;text-align:right;'>
        <div style='color:#ffff;font-weight:bold;font-size:1.4rem;height:100px;position:relative;'>
            <div style="font-family: 'Roboto Mono', monospace;padding-top:85vh;padding-right:100px;">
                <span id='serial2'>249105</span>
                <br>
                <span id='timestamp2'>2020/10/09 17:44:32</span>
            </div>
        </div>
    </div>

    <audio id="startup" src="sounds/startup.ogg" preload></audio>
    <audio id="on" src="sounds/on.ogg" preload></audio>
    <audio id="off" src="sounds/off.ogg" preload></audio>
    <audio id="recording" src="sounds/recording.ogg" preload></audio>

    <script src="script.js"></script>

    <script>
        const startup = document.getElementById("startup");
        const on = document.getElementById("on");
        const off = document.getElementById("off");
        const recording = document.getElementById("recording");

        addEventListener('message', function(event) {
            switch (event.data.type) {
                case "startup":
                    if (startup) {
                        startup.volume = event.data.volume;
                        startup.play();
                    }
                    break;

                case "on":
                    if (on) {
                        on.volume = event.data.volume;
                        on.play();
                    }
                    break;

                case "off":
                    if (off) {
                        off.volume = event.data.volume;
                        off.play();
                    }
                    break;

                case "recording":
                    if (recording) {
                        recording.volume = event.data.volume;
                        recording.play();
                    }
                    break;
            }
        });
    </script>
  </body>
</html>
